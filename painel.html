<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Tia do Doce</title>
    <style>
        body { font-family: sans-serif; background: url('fundo.png') fixed center; background-size: cover; padding: 20px; margin: 0; }
        .admin-card { background: rgba(255, 255, 255, 0.96); max-width: 600px; margin: auto; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .financeiro-box { background: #e3f2fd; padding: 15px; border-radius: 12px; margin: 20px 0; display: flex; justify-content: space-around; }
        .pedido-item { border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .btn-baixa { background: #25d366; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .estoque-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px dashed #ff85a1; }
    </style>
</head>
<body>
    <div class="admin-card" id="painel" style="display:none;">
        <h1 style="color:#ff85a1; text-align:center;">Painel da Tia üõ†Ô∏è</h1>
        
        <h3>üì¶ Estoque</h3>
        <div id="lista-estoque"></div>

        <h3>üí∞ Financeiro Quinzenal</h3>
        <div class="financeiro-box">
            <div>Pendentes: <b id="qtd-p">0</b></div>
            <div>A Receber: <b>R$ <span id="val-p">0,00</span></b></div>
        </div>
        <div id="lista-financeiro"></div>
        
        <button onclick="location.href='index.html'" style="margin-top:20px; cursor:pointer;">Voltar</button>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyB6FUb-KoF6S4h-y70trrcElPb2AYuUogM",
        authDomain: "tia-do-doce.firebaseapp.com",
        projectId: "tia-do-doce",
        storageBucket: "tia-do-doce.firebasestorage.app",
        messagingSenderId: "766286783719",
        appId: "1:766286783719:web:f49c11f7190c88cc44ae42"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const ADMIN = "carlos.sabino@outlook.com.br";

    onAuthStateChanged(auth, (user) => {
        if(user && user.email === ADMIN) {
            document.getElementById('painel').style.display = 'block';
            carregarTudo();
        } else {
            window.location.href = "index.html";
        }
    });

    function carregarTudo() {
        // Estoque
        onSnapshot(collection(db, "produtos"), (snap) => {
            const cont = document.getElementById('lista-estoque');
            cont.innerHTML = "";
            snap.forEach(sDoc => {
                const p = sDoc.data();
                cont.innerHTML += `<div class="estoque-item"><span>${p.nome}</span> <span>Qtd: ${p.estoque}</span></div>`;
            });
        });

        // Financeiro
        onSnapshot(collection(db, "pedidos"), (snap) => {
            const cont = document.getElementById('lista-financeiro');
            let qP = 0, vP = 0;
            cont.innerHTML = "<h4>Hist√≥rico de Pedidos:</h4>";
            snap.forEach(sDoc => {
                const ped = sDoc.data();
                if(ped.status === "Pendente") { qP++; vP += ped.total; }
                cont.innerHTML += `<div class="pedido-item">
                    <div><b>${ped.cliente}</b> (#${ped.pedidoId})<br>R$ ${ped.total.toFixed(2)} - ${ped.status}</div>
                    ${ped.status === "Pendente" ? `<button class="btn-baixa" onclick="baixar('${sDoc.id}')">Baixar</button>` : ''}
                </div>`;
            });
            document.getElementById('qtd-p').innerText = qP;
            document.getElementById('val-p').innerText = vP.toFixed(2);
        });
    }

    window.baixar = async (id) => {
        await updateDoc(doc(db, "pedidos", id), { status: "Pago" });
    };
</script>
</body>
</html>
